<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
    星空</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
<main class="content">
  <section class="jumbotron">
  <div class="video">
    
      <div class="video-frame">
        <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
      </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay=""
             poster="/images/ocean/ocean.png" x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">星空</a></h1>
      <p>好好吃饭，好好睡觉</p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="星空"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>

<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
      
        <article id="post-SQL使用视图" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE/">SQL使用视图</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是虚拟的表。视图只包含使用时动态检索数据的查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- VIEW</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers, Orders, OrderItems <span class="keyword">WHERE</span> Customers.cust_id = Orders.cust_id <span class="keyword">AND</span> OrderItems.order_num = Orders.order_num <span class="keyword">AND</span> prod_id = <span class="string">'RGAN01'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> ProductCustomers <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="为什么使用视图"><a href="#为什么使用视图" class="headerlink" title="为什么使用视图"></a>为什么使用视图</h3><p>视图的一些常见应用：</p>
<ul>
<li>重用SQL语句</li>
<li>简化复杂的SQL操作。</li>
<li>使用表的一部分而不是整个表</li>
<li>保护数据。可以授权用户访问表的特定部分的权限，而不是整个表的访问权限。</li>
<li>更改数据格式和表示</li>
</ul>
<h3 id="视图的规则与限制"><a href="#视图的规则与限制" class="headerlink" title="视图的规则与限制"></a>视图的规则与限制</h3><p>视图创建和使用的一些最常见的规则和限制：</p>
<ul>
<li>与表一样，视图必须唯一命名</li>
<li>对于可以创建的视图数目没有限制</li>
<li>创建视图，必须具有足够的访问权限</li>
<li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造视图</li>
<li>许多DBMS禁止在视图查询中使用ORDER BY子句</li>
<li>有些DBMS要求对返回的列进行命名，如果列是计算字段，则需要使用别名</li>
<li>视图不能索引，也不能有关联的触发器或默认值</li>
<li>有些DBMS把视图作为只读的查询，这表示可以从试图检索数据，但不能将数据写回底层表</li>
<li>有些DBMS允许创建这样的视图，它不能进行导致行不再属于视图的插入或更新。</li>
</ul>
<h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><p>视图用CREATE VIEW语句来创建。<br>删除视图，可以使用DROP语句，其语法为DROP VIEW viewname.</p>
<h3 id="利用视图简化复杂的联结"><a href="#利用视图简化复杂的联结" class="headerlink" title="利用视图简化复杂的联结"></a>利用视图简化复杂的联结</h3><p>一个最常见的视图应该是隐藏复杂的SQL，这通常涉及联结。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE VIEW</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ProductCustomers <span class="keyword">AS</span> <span class="keyword">SELECT</span> cust_name, cust_contact, prod_id <span class="keyword">FROM</span> Customers, Orders, OrderItems <span class="keyword">WHERE</span> Customers.cust_id = Orders.cust_id <span class="keyword">AND</span> OrderItems.order_num = Orders.order_num; <span class="comment">-- CREATE VIEW</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> ProductCustomers <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>; <span class="comment">-- SELECT FROM VIEW</span></span><br></pre></td></tr></table></figure>

<h3 id="用视图重新格式化检索出的"><a href="#用视图重新格式化检索出的" class="headerlink" title="用视图重新格式化检索出的"></a>用视图重新格式化检索出的</h3><p>视图的另一常见用途是重新格式化检索出的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FORMAT DATA</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'（'</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'（'</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> VendorsLocations <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'（'</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> VendorsLocations <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'（'</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors;</span><br></pre></td></tr></table></figure>

<h3 id="用视图过滤不想要的数据"><a href="#用视图过滤不想要的数据" class="headerlink" title="用视图过滤不想要的数据"></a>用视图过滤不想要的数据</h3><p>视图对于应用哦个普通的WHERE子句也很有用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FILTER NOT NEED DATA USE VIEW</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> CustomerEMailList <span class="keyword">AS</span> <span class="keyword">SELECT</span> cust_id, cust_name, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> CustomerEMailList;</span><br></pre></td></tr></table></figure>

<h3 id="使用视图与计算字段"><a href="#使用视图与计算字段" class="headerlink" title="使用视图与计算字段"></a>使用视图与计算字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- USE VIEW AND CALCULATE FIELD</span></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, quantity, item_price, quantity*item_price <span class="keyword">AS</span> expanded_price <span class="keyword">FROM</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">20008</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> OrderItemsExpanded <span class="keyword">AS</span> <span class="keyword">SELECT</span> order_num, prod_id, quantity, item_price, quantity*item_price <span class="keyword">AS</span> expanded_price <span class="keyword">FROM</span> OrderItems;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OrderItemsExpanded <span class="keyword">WHERE</span> order_num=<span class="number">20008</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE/" data-id="ckrdp6n4h0001ksi496lmeb1u"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL联结表" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E8%81%94%E7%BB%93%E8%A1%A8/">SQL联结表</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E8%81%94%E7%BB%93%E8%A1%A8/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="联结"><a href="#联结" class="headerlink" title="联结"></a>联结</h2><p>SQL最强大的功能之一就是能在数据查询的执行中联结（join）表。<br>联结是利用SQL的SELECT能执行的最重要的操作。</p>
<h3 id="关系表"><a href="#关系表" class="headerlink" title="关系表"></a>关系表</h3><h3 id="为什么使用联结"><a href="#为什么使用联结" class="headerlink" title="为什么使用联结"></a>为什么使用联结</h3><p>如果数据存储在多个表中，使用联结就可以用一条SELECT语句就检索出数据。<br>联结是一种机制，用来在一条SELECT语句中关联表，因此称为联结。</p>
<h2 id="创建联结"><a href="#创建联结" class="headerlink" title="创建联结"></a>创建联结</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_name, prod_name, prod_price <span class="keyword">FROM</span> Vendors, Products <span class="keyword">WHERE</span> Vendors.vend_id = Products.vend_id;</span><br></pre></td></tr></table></figure>

<h3 id="WHERE子句的重要性"><a href="#WHERE子句的重要性" class="headerlink" title="WHERE子句的重要性"></a>WHERE子句的重要性</h3><p>所有联结都有WHERE子句。<br>返回笛卡尔积的链接，也称叉联结（cross join）;</p>
<h3 id="内联结"><a href="#内联结" class="headerlink" title="内联结"></a>内联结</h3><p>基于两个表之间的相等测试，称为等值联结（equijoin）。这种联结也成为内联结（inner join）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- INNER JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_name, prod_name, prod_price <span class="keyword">FROM</span> Vendors <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Products <span class="keyword">ON</span> Vendors.vend_id = Products.vend_id;</span><br></pre></td></tr></table></figure>

<h3 id="联结多个表"><a href="#联结多个表" class="headerlink" title="联结多个表"></a>联结多个表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- JOIN MULTI TABLES</span></span><br><span class="line"><span class="keyword">SELECT</span> prod_name, vend_name, prod_price, quantity <span class="keyword">FROM</span> OrderItems, Products, Vendors <span class="keyword">WHERE</span> Products.vend_id = Vendors.vend_id <span class="keyword">AND</span> OrderItems.prod_id = Products.prod_id <span class="keyword">AND</span> order_num = <span class="number">20007</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_id <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> cust_id <span class="keyword">from</span> Orders <span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> OrderItems <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span></span><br><span class="line">	)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers, Orders, OrderItems <span class="keyword">WHERE</span> Customers.cust_id = Orders.cust_id <span class="keyword">AND</span> Orders.order_num = OrderItems.order_num <span class="keyword">AND</span> prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E8%81%94%E7%BB%93%E8%A1%A8/" data-id="ckrdp6n5a000tksi4kor84xur"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL汇总数据" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E6%B1%87%E6%80%BB%E6%95%B0%E6%8D%AE/">SQL汇总数据</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E6%B1%87%E6%80%BB%E6%95%B0%E6%8D%AE/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h2><p><strong>聚集函数</strong>（aggregate function）对某些行运行的函数，计算并返回一个值。</p>
<h3 id="AVG-函数"><a href="#AVG-函数" class="headerlink" title="AVG()函数"></a>AVG()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> Products;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> vend_id = <span class="string">'DLL01'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="COUNT-函数"><a href="#COUNT-函数" class="headerlink" title="COUNT()函数"></a>COUNT()函数</h3><p>COUNT()函数有两种使用方式：</p>
<ul>
<li>使用COUNT(*)对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值</li>
<li>使用COUNT(column)对特定列中具有值的行进行技术，忽略NULL值。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- COUNT</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_cust <span class="keyword">FROM</span> Customers;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(cust_email) <span class="keyword">AS</span> num_cust <span class="keyword">FROM</span> Customers; <span class="comment">-- 使用列名时忽略NULL的值，使用*不忽略</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="MAX-函数"><a href="#MAX-函数" class="headerlink" title="MAX()函数"></a>MAX()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MAX</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(prod_price) <span class="keyword">AS</span> max_price <span class="keyword">FROM</span> Products;  <span class="comment">-- 忽略列值为NULL的行</span></span><br></pre></td></tr></table></figure>

<h3 id="MIN-函数"><a href="#MIN-函数" class="headerlink" title="MIN()函数"></a>MIN()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MIN </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(prod_price) <span class="keyword">AS</span> min_price <span class="keyword">FROM</span> Products;  <span class="comment">-- 用于文本数据时，MIN()返回该列排序后最前面的行，MAX()返回该列排序后最后的行</span></span><br></pre></td></tr></table></figure>

<h3 id="SUM-函数"><a href="#SUM-函数" class="headerlink" title="SUM()函数"></a>SUM()函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SUM</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(quantity) <span class="keyword">AS</span> items_ordered <span class="keyword">FROM</span> orderItems <span class="keyword">WHERE</span> order_num = <span class="number">20005</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(item_price*quantity) <span class="keyword">AS</span> total_price <span class="keyword">FROM</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">20005</span>; <span class="comment">-- SUM()函数忽略值为NULL的行。</span></span><br></pre></td></tr></table></figure>

<h2 id="聚集不同值"><a href="#聚集不同值" class="headerlink" title="聚集不同值"></a>聚集不同值</h2><p>上述5个聚集函数都可以如下使用：</p>
<ul>
<li>对所有行执行计算，指定ALL参数或不指定参数(因为ALL是默认行为)</li>
<li>只包含不同的值，指定DISTINCT参数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(<span class="keyword">DISTINCT</span> prod_price) <span class="keyword">AS</span> avg_price <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> vend_id = <span class="string">'DLL01'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="组合聚集函数"><a href="#组合聚集函数" class="headerlink" title="组合聚集函数"></a>组合聚集函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_items, <span class="keyword">MIN</span>(prod_price) <span class="keyword">AS</span> price_min, <span class="keyword">MAX</span>(prod_price) <span class="keyword">AS</span> price_max, <span class="keyword">AVG</span>(prod_price) <span class="keyword">AS</span> price_avg <span class="keyword">FROM</span> products;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E6%B1%87%E6%80%BB%E6%95%B0%E6%8D%AE/" data-id="ckrdp6n5c000wksi4g63ukwhz"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL管理事务处理" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/">SQL管理事务处理</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>介绍事务处理，以及如何利用COMMIT和ROLLBACK语句管理事务处理。</p>
<h2 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h2><p>使用<strong>事务处理</strong>（transaction processing），通过确保成批的SQL操作要么完全执行，要么完全不执行，来维护数据的完整性。<br>事务处理是一种机制，用来管理必须成批执行的SQL操作，保证数据库不包含不完整的操作结果。<br>事务处理的几个术语：</p>
<ul>
<li><strong>事务</strong>（tranction）指一组SQL语句</li>
<li><strong>回退</strong>（rollback）指撤销指定SQL语句的过程</li>
<li><strong>提交</strong>（commit）指将未存储的SQL语句结果写入数据库表</li>
<li><strong>保留点</strong>（savepoint）指四和五处理中设置的<strong>临时占位符</strong>（placeholder）,可以对他发布回退（与回退整个事务处理不同）</li>
</ul>
<p>可以回退哪些语句<br>事务处理用来管理INSERT、UPDATE和DELTE语句。不能回退SELECT语句（回退SELECT语句也没必要），也不能回退CREATE和DROP操作。事务处理中可以使用这些语句，但进行回退时，这些操作也不能撤销。</p>
<h2 id="控制事务处理"><a href="#控制事务处理" class="headerlink" title="控制事务处理"></a>控制事务处理</h2><p>管理事务的关键在于将SQL语句组分解为逻辑块，并明确规定数据合适应该回退，合适不应该回退。<br>有的DBMS要求明确表示事务处理块的开始和结束。<br>在SQL Server中，标识如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">TRANSACTION</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">COMMIT</span> <span class="keyword">TRANSACTION</span></span><br></pre></td></tr></table></figure>

<p>在BEGIN TRANSACTION和COMMIT TRANSACTION语句之间的SQL必须完全执行或者完全不执行。<br>在MariaDB和MySQL中等同的代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STRAT TRANSACTION</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在Oracle使用的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">TRANSACTION</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在PostgreSQL使用ANSI SQL语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="使用ROLLBACK"><a href="#使用ROLLBACK" class="headerlink" title="使用ROLLBACK"></a>使用ROLLBACK</h3><p>SQL的ROLLBACK命令用来回退（撤销）SQL语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ROLLBACK</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Orders;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用COMMIT"><a href="#使用COMMIT" class="headerlink" title="使用COMMIT"></a>使用COMMIT</h3><p>一般的SQL语句都是针对数据库表直接执行和编写的。就是所谓的<strong>隐式提交</strong>（implicit commit），即提交（写或保存）操作是自动进行的。<br>在事务处理模块中，提交不会隐式进行。<br>进行明确的提交，使用COMMIT语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- COMMIT</span></span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="keyword">DELETE</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">12345</span></span><br><span class="line"><span class="keyword">DELETE</span> Orders <span class="keyword">WHERE</span> order_num =<span class="number">12345</span></span><br><span class="line"><span class="keyword">COMMIT</span> <span class="keyword">TRANSACTION</span>       <span class="comment">-- SQL Server</span></span><br><span class="line"><span class="comment">### 使用保留点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="keyword">DELETE</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">12345</span>;</span><br><span class="line">DELELE Orders WHERE order_num = 12345;</span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- Oracle</span></span><br></pre></td></tr></table></figure>

<h3 id="使用保留点"><a href="#使用保留点" class="headerlink" title="使用保留点"></a>使用保留点</h3><p>使用简单的ROLLBACK和COMMIT语句，就可以写入或撤销整个事务。倒是，只对简单的事务才能这样做，复杂的事务可能需要部分提交或回退。<br>要支持回退部分事务，必须在事务处理块中的合适位置放置占位符。<br>在SQL中，这些占位符称为保留点。<br>在MariaDB、MySQL和Oracle中创建占位符，可使用SAVEPOINT语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SAVEPOINT</span> delete1;</span><br></pre></td></tr></table></figure>

<p>在SQL Server中，如下进行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAVE TRANSACTION delte1;</span><br></pre></td></tr></table></figure>

<p>每个保留点都要取能够标识它的唯一名字，以便在回退时，DBMS知道回退到何处。<br>在SQL Server中，可如下进行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TRANSACTION</span> delete1;  <span class="comment">-- SQL Server ROLLBACK TO SAVEPOINT</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> delete1;  <span class="comment">-- Maria MySQL AND Oracle ROLLBACK TO PLACEHOLDER</span></span><br></pre></td></tr></table></figure>

<p>一个完整的SQL Server例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FULL ROLLBACK OF SQL Server</span></span><br><span class="line"><span class="keyword">BEGIN</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Customers(cust_id, cust_name)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">'1000000010'</span>, <span class="string">'Toys Emporium'</span>);</span><br><span class="line">SAVE TRANSACTION StartOrder;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">Order</span>(order_num, order_date, cust_id)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">20100</span>, <span class="string">'2001/12/1'</span>, <span class="string">'1000000010'</span>);</span><br><span class="line">IF @@ERROR &lt;&gt; 0 ROLLBACK TRANSACTION StrarOrder;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OrderItems(order_num, order_item, prod_id, quantity, item_price)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">20100</span>, <span class="number">1</span>, <span class="string">'BR01'</span>, <span class="number">100</span>, <span class="number">5.49</span>);</span><br><span class="line">IF @@ERROE &lt;&gt; 0 ROLLBACK TRANSACTION StratOrder;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OrderItems(order_num, order_item, prod_id, quantity, item_price)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">20100</span>, <span class="number">2</span>, <span class="string">'BR03'</span>, <span class="number">100</span>, <span class="number">10.99</span>);</span><br><span class="line">IF @@ERROR &lt;&gt; 0 ROLLBACK TRANSACTION StartOrder;</span><br><span class="line"><span class="keyword">COMMIT</span> <span class="keyword">TRANSACTION</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86/" data-id="ckrdp6n5f0010ksi4u5m4a5da"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL组合查询" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2/">SQL组合查询</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>利用UNION操作符将多条SELECT语句组合成一个结果集。</p>
<h2 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h2><p>多数SQL查询只包含从一个或多个表中返回数据的单条SELECT语句。但是，SQL也允许执行多个查询（多条SELECT语句），并将结果作为一个查询结果集返回。<br>这些组合查询通常称为<strong>并</strong>（union）或<strong>复合查询</strong>（compound query）。<br>以下情况需要使用组合查询：</p>
<ul>
<li>在一个查询中从不同的表返回结构数据；</li>
<li>对一个表执行多个查询，按一个查询返回数据。<h2 id="常见组合查询"><a href="#常见组合查询" class="headerlink" title="常见组合查询"></a>常见组合查询</h2><h3 id="使用UNION"><a href="#使用UNION" class="headerlink" title="使用UNION"></a>使用UNION</h3>使用UNION所要做的就是给出每条SELECT语句，在各条语句之间放上关键字UNION。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UTILIZE UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">'IL'</span>,<span class="string">'IN'</span>,<span class="string">'MI'</span>); <span class="comment">-- SINGLE QUERY</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name = <span class="string">'Fun4All'</span>; <span class="comment">-- SINGLE QUERY</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">'IL'</span>,<span class="string">'IN'</span>,<span class="string">'MI'</span>) <span class="keyword">UNION</span> <span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name = <span class="string">'Fun4All'</span>; <span class="comment">-- UNION QUERY</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">'IL'</span>,<span class="string">'IN'</span>,<span class="string">'MI'</span>) <span class="keyword">OR</span> cust_name = <span class="string">'Fun4All'</span>; <span class="comment">-- MULTI WHERE</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="UNION规则"><a href="#UNION规则" class="headerlink" title="UNION规则"></a>UNION规则</h3><p>进行组合时需要注意几条规则：</p>
<ul>
<li>UNION必须由两条或者两条以上的SELECT语句组成，语句之间用关键字UNION分割</li>
<li>UNION中的每个查询必须包含相同的列、表达式或聚集函数</li>
<li>列数据类型必须兼容：类型不必完全相同，但必须是DBMS可以隐含转换的类型。<h3 id="包含或取消重复的行"><a href="#包含或取消重复的行" class="headerlink" title="包含或取消重复的行"></a>包含或取消重复的行</h3>UNION默认自动取消重复的列。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- INCLUDE OR EXCLUDE DUPLICATE ROW</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">'IL'</span>, <span class="string">'IN'</span>, <span class="string">'MI'</span>) <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> cust_name, cust_contact, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name = <span class="string">'Fun4All'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="对组合查询结果排序"><a href="#对组合查询结果排序" class="headerlink" title="对组合查询结果排序"></a>对组合查询结果排序</h3><p>某些DBMS还支持另外两种UNION：</p>
<ul>
<li>EXCEPT（有时称为MINUS）可用来检索旨在第一个表中存在而在第二个表中不存在的行</li>
<li>INTERSECT可用来检索两个表中都存在的行</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2/" data-id="ckrdp6n6n001vksi4fp9rc6we"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL使用子查询" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2/">SQL使用子查询</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p><strong>查询</strong>（query）任何SQL语句都是查询。但此术语一般指SELECT语句。<br>SQL还允许创建子查询（subquery），即嵌套在其它查询中的查询。</p>
<h2 id="利用子查询进行过滤"><a href="#利用子查询进行过滤" class="headerlink" title="利用子查询进行过滤"></a>利用子查询进行过滤</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FILTER BY SUBQUERY</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> orderitems <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> orderitems <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> customers <span class="keyword">WHERE</span> cust_id <span class="keyword">in</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> cust_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> orderitems <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span></span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>作为子查询的SELECT语句只能查询单个列。企图检索多个列将返回错误。</p>
</blockquote>
<h2 id="作为计算字段使用子查询"><a href="#作为计算字段使用子查询" class="headerlink" title="作为计算字段使用子查询"></a>作为计算字段使用子查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- USE SUBQUERY AS CALCULATE FIELD</span></span><br><span class="line"><span class="keyword">SELECT</span> *, (<span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> orders o <span class="keyword">WHERE</span> o.cust_id = c.cust_id) <span class="keyword">AS</span> cust_order_num <span class="keyword">FROM</span> customers c; <span class="comment">-- DIY</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_state, (<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Orders.cust_id = Customers.cust_id) <span class="keyword">AS</span> orders <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2/" data-id="ckrdp6n4b0000ksi4dcd1i2x2"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL高级SQL特性" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E9%AB%98%E7%BA%A7SQL%E7%89%B9%E6%80%A7/">SQL高级SQL特性</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E9%AB%98%E7%BA%A7SQL%E7%89%B9%E6%80%A7/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><p>关系数据库存储分解为多个表的数据，每个表存储相应的数据。利用键来简历从一个表到另一个表的引用（由此产生了数据<strong>引用完整性</strong>（referential integrity））。<br><strong>约束</strong>（constraint）管理如何插入或处理数据库数据的规则。<br>DBMS通过在数据库表上施加约束来实施引用完整性。</p>
<h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><p>主键是一种特殊的约束，用来保证一列（或一组列） 中的值是唯一的，而且永不改动。<br>表中任意列只要满足以下条件，都可以用于主键：</p>
<ul>
<li>任意两行的主键值都不相同</li>
<li>每行都具有一个主键值</li>
<li>包含主键值的列从不修改或更新</li>
<li>主键值不能重用<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Vendors</span><br><span class="line">(</span><br><span class="line">	vend_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	vend_name <span class="built_in">CHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	vend_address <span class="built_in">CHAR</span>(<span class="number">50</span>) <span class="literal">NULL</span>,</span><br><span class="line">	vend_city <span class="built_in">CHAR</span>(<span class="number">50</span>) <span class="literal">NULL</span>,</span><br><span class="line">	vend_state <span class="built_in">CHAR</span>(<span class="number">5</span>) <span class="literal">NULL</span>,</span><br><span class="line">	vend_zip <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="literal">NULL</span>,</span><br><span class="line">	vend_country <span class="built_in">CHAR</span>(<span class="number">50</span>) <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Vendors <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> PRIMARY <span class="keyword">KEY</span>(vend_id);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h3><p>外键是表中的一列，其值必须列在另一表的主键中。<br>外键是保证引用完整性的极其重要的部分。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">	order_num <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	order_date DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	cust_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">REFERENCES</span> Customers(cust_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Orders <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(cust_id) <span class="keyword">REFERENCES</span> Customers(cust_id)</span><br></pre></td></tr></table></figure>

<h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><p>唯一约束用来保证一列（或一组列）中的数据是唯一的。<br>与主键的区别：</p>
<ul>
<li>表可包含多个唯一约束，但每个表只允许一个主键</li>
<li>唯一约束列可包含NULL值</li>
<li>唯一约束列可修改或更新</li>
<li>唯一约束列的值可重复使用</li>
<li>与逐渐不一样，唯一约束不能用来定义外键。<br>唯一约束既可以用UNIQUE关键字在标定一种定义，也可以用单独的CONSTRAINT定义。</li>
</ul>
<h3 id="检查约束"><a href="#检查约束" class="headerlink" title="检查约束"></a>检查约束</h3><p>检查约束常见的用途：</p>
<ul>
<li>检查最小或最大值。例如防止0个物品的订单</li>
<li>指定范围。例如保证发货日期大于等于今天的日期</li>
<li>只允许特定的值<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CHECK CONSTRAINT</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> OrderItems</span><br><span class="line">(</span><br><span class="line">	order_num <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	order_item <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	prod_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	quantity <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">CHECK</span>(quentity &gt; <span class="number">0</span>),</span><br><span class="line">	item_price MONEY <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line">ADD CONSTRAINT <span class="keyword">CHECK</span>(gender <span class="keyword">LIKE</span> <span class="string">'[MF]'</span>)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引用来排序数据以加快搜索和排序操作的速度。<br>可以在一个或多个列上定义索引，使DBMS保存其内容的一个排过序的列表。<br>创建索引必须注意：</p>
<ul>
<li>索引改善检索操作的性能，但降低了数据插入、修改和删除的性能。在执行这些操作时，DBMS必须动态地更新索引</li>
<li>索引数据可能要占用大量的存储空间</li>
<li>并非所有数据都适合索引。取值更多的数据，通过索引能得到更多好处</li>
<li>索引用于数据过滤和数据排序。如果经常以某种特定顺序排序数据，则该数据可能适合做索引</li>
<li>可以在索引中定义多个列。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> prod_name_ind <span class="keyword">ON</span> PRODUCTS(prod_name);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器是特殊的存储过程，它在特定的数据库活动发生时自动执行。<br>触发器可以与特定表上的INSERT、UPDATE和DELETE操作（或组合）相关联。<br>触发器与单个的表相关联。</p>
<p>触发器内的代码具有一下数据的访问权：</p>
<ul>
<li>INSERT操作中的所有数据</li>
<li>UPDATE操作中的所有新数据和旧数据</li>
<li>DELETE操作中删除的数据<br>触发器可以在特定操作执行之前和之后执行。</li>
</ul>
<p>触发器的常见用途：</p>
<ul>
<li>保证数据一致。例如，在INSERT或UPDATE操作中将所有州名转换为大写。</li>
<li>基于某个表的变动在其他表上执行活动。例如每当更新或删除一行是将审计跟踪记录写入某个日志表</li>
<li>进行额外的验证并根据需要回退数据。</li>
<li>计算计算列的值或更新时间戳。<br>创建一个触发器，他对所有INSERT和UPDATE操作，将Customers表中的cust_state列转换为大写<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- TRIGGER</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> customer_state </span><br><span class="line"><span class="keyword">ON</span> Customers</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span></span><br><span class="line"><span class="keyword">AS</span> <span class="keyword">UPDATE</span> Customers</span><br><span class="line"><span class="keyword">SET</span> cust_state = <span class="keyword">Upper</span>(cust_state)</span><br><span class="line"><span class="keyword">WHERE</span> Customers.cust_id = inserted.cust_id; <span class="comment">-- SQL Server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> customer_state </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">OR</span> <span class="keyword">UPDATE</span></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">UPDATE</span> Customers</span><br><span class="line"><span class="keyword">SET</span> cust_state=<span class="keyword">Upper</span>(cust_state)</span><br><span class="line"><span class="keyword">WHERE</span> Customers.cust_id=:OLD.cust_id</span><br><span class="line"><span class="keyword">END</span>;                                          <span class="comment">-- Oracle PostgreSQL</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="数据库安全"><a href="#数据库安全" class="headerlink" title="数据库安全"></a>数据库安全</h2><p>任何安全系统的基础都是用户授权和身份确认。<br>一般来说，需要保护的操作有：</p>
<ul>
<li>对数据库管理功能（创建表、更改或删除已存在的表）的访问</li>
<li>对特定数据库或表的访问</li>
<li>访问的类型（只读、对特定列的访问等）</li>
<li>仅通过视图或存储过程对表进行访问</li>
<li>创建多层次的安全措施，从而匀速多种基于登录的访问和控制</li>
<li>限制管理用户账号的能力<br>安全性使用SQL的GRANT和REVOKE语句来管理。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E9%AB%98%E7%BA%A7SQL%E7%89%B9%E6%80%A7/" data-id="ckrdp6n6u001yksi4ig7suytl"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL使用游标" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87/">SQL使用游标</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p><strong>结果集</strong> SQL查询所检索出的结果。<br>有时需要在检索出来的行中前进或者后退一行或多行，这就是游标的用途所在。<br><strong>游标</strong>是一个存储在DBMS服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。<br>游标常见的一些选项和特性如下：</p>
<ul>
<li>能够标记游标为只读，使数据能读取，但不能更新和删除</li>
<li>能控制可以执行的定向操作（向前、向后、第一、绝对位置、相对位置等）</li>
<li>能标记某些列为可编辑的，某些列为不可编辑的</li>
<li>规定范围，使游标对创建它的特定请求（如存储过程）或对所有请求可访问</li>
<li>只是DBMS对检索出的数据（而不是指出表中活动数据）进行复制，使数据在游标打开和访问期间不变化</li>
</ul>
<h2 id="使用游标"><a href="#使用游标" class="headerlink" title="使用游标"></a>使用游标</h2><p>使用游标涉及几个明确的步骤：</p>
<ul>
<li>在使用游标前，必须声明（定义）它</li>
<li>一旦声明，就必须打开游标以供使用</li>
<li>对于填有数据的游标，根据需要取出（检索）各行</li>
<li>在结束游标使用时，必须关闭游标，可以的话，释放游标</li>
</ul>
<h3 id="创建游标"><a href="#创建游标" class="headerlink" title="创建游标"></a>创建游标</h3><p>使用DELAERE语句创建游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE CURSOR</span></span><br><span class="line"><span class="keyword">DECLARE</span> CustCursor <span class="keyword">CURSOR</span> </span><br><span class="line"><span class="keyword">FOR</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="comment">-- DB2 MariaDB MySQL SQL Server</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">CURSOR</span> CustCursor</span><br><span class="line"><span class="keyword">IS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="comment">-- Oracle PostgreSQL</span></span><br></pre></td></tr></table></figure>

<h3 id="使用游标-1"><a href="#使用游标-1" class="headerlink" title="使用游标"></a>使用游标</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UTILIZE CURSOR</span></span><br><span class="line">OPEN CURSOR CustCursor</span><br></pre></td></tr></table></figure>

<p>FETCH可以访问游标数据。FETCH指出要检索哪些行，从何处检索它们以及将它们放于何处（如变量名）。<br>使用Oracle语法从游标检索一行（第一行）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">TYPE</span> CustCursor <span class="keyword">IS</span> <span class="keyword">REF</span></span><br><span class="line"><span class="keyword">CURSOR</span></span><br><span class="line">	<span class="keyword">RETURN</span> Customers%ROWTYPE;</span><br><span class="line"><span class="keyword">DECLARE</span> CustRecord</span><br><span class="line">Customres%ROWTYPE</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">OPEN</span> CustCursor;</span><br><span class="line">	FETCH CustCursor INTO CustRecord;</span><br><span class="line">	CLOSE CustCursor;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>使用Oracle语法，从第一行到最后一行，对检索出来的数据进行循环：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">TYPE</span> CustCursor <span class="keyword">IS</span> <span class="keyword">REF</span></span><br><span class="line"><span class="keyword">CURSOR</span></span><br><span class="line">    <span class="keyword">RETURN</span> Customers%ROWTYPE;</span><br><span class="line"><span class="keyword">DECLARE</span> CustRecord</span><br><span class="line">Customers%ROWTYPE</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">OPEN</span> CustCursor;</span><br><span class="line">    LOOP</span><br><span class="line">    FETCH CustCursor INTO CustRecord;</span><br><span class="line">    EXIT WHEN CustCursor%NOTFOUND;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">    CLOSE CustCursor;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>使用SQL Server</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> @cust_id <span class="built_in">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">	@cust_name <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_address <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_city <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_state <span class="built_in">CHAR</span>(<span class="number">5</span>),</span><br><span class="line">	@cust_zip <span class="built_in">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">	@cust_country <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_contact <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_email <span class="built_in">CHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">OPEN</span> CustCursor</span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> CustCursor</span><br><span class="line"><span class="keyword">INTO</span> @cust_id, @cust_name, @cust_address, @cust_city, @cust_state,</span><br><span class="line">@cust_zip, @cust_couontry, @cust_contact, @cust_email</span><br><span class="line"><span class="keyword">WHILE</span> @@FETCH_STATUS = <span class="number">0</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> CustCursor</span><br><span class="line">	<span class="keyword">INTO</span> @cust_id, @cust_name, @cust_address, @cust_city, @cust_state, </span><br><span class="line">	@cust_zip, @cust_coruntry, @cust_contact, @cust_email</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">CLOSE</span> CustCursor</span><br></pre></td></tr></table></figure>

<h3 id="关闭游标"><a href="#关闭游标" class="headerlink" title="关闭游标"></a>关闭游标</h3><p>DB2、 Oracle和PostgreSQL的语法关闭游标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE CustCursor</span><br></pre></td></tr></table></figure>

<p>SQL Server</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLOSE CustCursor</span><br><span class="line"><span class="keyword">DEALLOCATE</span> <span class="keyword">CURSOR</span> CustCursor</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87/" data-id="ckrdp6n4m0004ksi4xod7k8u9"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL使用数据处理函数" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/">SQL使用数据处理函数</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p><img src="/images/20190524144953320_24174.png" alt="DBMS函数的差异"></p>
<h2 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h2><h3 id="文本处理函数"><a href="#文本处理函数" class="headerlink" title="文本处理函数"></a>文本处理函数</h3><p><img src="/images/20190524145958787_19315.png" alt="常用的文本处理函数"><br>SOUNDEX是一个将任何文本串转换为描述其语音表示的字幕数字模式的算法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name, <span class="keyword">UPPER</span>(vend_name) <span class="keyword">AS</span> vend_name_upcase <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_contact = <span class="string">'Michael Green'</span>;  <span class="comment">-- 联系名错误，实际上应该是Michael Green</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> <span class="keyword">SOUNDEX</span>(cust_contact) = <span class="string">'Michael Green'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="日期和时间处理函数"><a href="#日期和时间处理函数" class="headerlink" title="日期和时间处理函数"></a>日期和时间处理函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- DATE AND TIME FUNCTION</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> <span class="keyword">DATEPART</span>(yy, order_date) = <span class="number">2012</span>;  <span class="comment">-- SQL Server 适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> <span class="keyword">DATEPART</span>(<span class="string">'yyyy'</span>, order_date) = <span class="number">2012</span>; <span class="comment">-- Access适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> DATE_PART(<span class="string">'year'</span>, order_date) = <span class="number">2012</span>; <span class="comment">-- PostgreSQL适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> to_number(to_char(order_date, <span class="string">'YYYY'</span>)) = <span class="number">2012</span>; <span class="comment">-- Oracle适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> order_date <span class="keyword">BETWEEN</span> <span class="keyword">to_date</span>(<span class="string">'01-01-2012'</span>) <span class="keyword">AND</span> <span class="keyword">to_date</span>(<span class="string">'12-31-2012'</span>); <span class="comment">-- Oracle</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(order_date) = <span class="number">2012</span>; <span class="comment">-- MySQL 和MariaDB适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> strfime(<span class="string">'%Y'</span>, order_date) = <span class="number">2012</span>; <span class="comment">-- SQLite</span></span><br></pre></td></tr></table></figure>

<h3 id="数值处理函数"><a href="#数值处理函数" class="headerlink" title="数值处理函数"></a>数值处理函数</h3><p>在主要DBMS的函数中，数值函数是最一致、最统一的函数。<br><img src="/images/20190524152132600_3337.png" alt="常用数值处理函数"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/" data-id="ckrdp6n4n0005ksi4zvythd9k"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL更新和删除数据" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE/">SQL更新和删除数据</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>利用UPDATE和DELETE语法进一步操作表数据</p>
<h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><p>两种使用UPDATE的方式：</p>
<ul>
<li>更新表中的特定行</li>
<li>更新表中的所有行<br>基本的UPDATE语句由三部分组成，分别是：</li>
<li>要更新的表</li>
<li>列名和它们的新值</li>
<li>确定要更新哪些行的过滤条件<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UPDATE</span></span><br><span class="line"><span class="keyword">UPDATE</span> Customers <span class="keyword">SET</span> cust_email = <span class="string">'kim@thetoystore.com'</span> <span class="keyword">WHERE</span> cust_id = <span class="string">'1000000005'</span>; <span class="comment">-- UPDATE SINGLE COLUMN</span></span><br><span class="line"><span class="keyword">UPDATE</span> Customers <span class="keyword">SET</span> cust_contact = <span class="string">'Sam Roberts'</span>, cust_email = <span class="string">'sam@toyland.com'</span> <span class="keyword">WHERE</span> cust_id = <span class="string">'1000000006'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> Customers <span class="keyword">SET</span> cust_email=<span class="literal">NULL</span> <span class="keyword">WHERE</span> cust_id=<span class="string">'1000000005'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>使用DELETE的两种方法：</p>
<ul>
<li>从表中删除特定的行</li>
<li>从表中删除所有的行<br>如果想从表中删除所有行，不要使用DELETE。可使用TRUNCATE TABLE语句，它完成相同的动作，而且速度更快。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- DELETE</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_id=<span class="string">'1000000006'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="更新和删除的指导原则"><a href="#更新和删除的指导原则" class="headerlink" title="更新和删除的指导原则"></a>更新和删除的指导原则</h2><p>使用UPDATE或DELETE时所遵循的重要原则：</p>
<ul>
<li>除非确实打算更新和删除每一行，否则绝对不要使用不带WHERE子句的UPDATE或DELETE语句。</li>
<li>保证每个表都有主键</li>
<li>在UPDAET或DELETE 语句使用WHERE子句前，应该先用SELECT进行测试，保证它过滤的是正确的记录</li>
<li>使用强制实施引用完整性的数据库，这样DBMS将不允许删除其数据与其他表相关联的行</li>
<li>有的DBMS允许数据库管理员施加约束，防止执行不带WHERE子句的UPDATE或DELETE 语句。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE/" data-id="ckrdp6n58000pksi4gxoymdz9"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
  </article>
  

  
    <nav class="page-nav">
      
      <a class="extend prev" rel="prev" href="/">Prev page</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next page</a>
    </nav>
  
</section>
</div>

  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2021 星空</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="星空"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/snap.svg-min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>






<script src="/js/ocean.js"></script>


</body>
</html>