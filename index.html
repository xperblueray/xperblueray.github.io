<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
    星空</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
<main class="content">
  <section class="jumbotron">
  <div class="video">
    
      <div class="video-frame">
        <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
      </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay=""
             poster="/images/ocean/ocean.png" x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">星空</a></h1>
      <p>好好活下去</p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="星空"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>

<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
      
        <article id="post-jar和war的转换" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/09/14/jar%E5%92%8Cwar%E7%9A%84%E8%BD%AC%E6%8D%A2/">jar和war的转换</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/09/14/jar%E5%92%8Cwar%E7%9A%84%E8%BD%AC%E6%8D%A2/" class="article-date">
  <time datetime="2021-09-14T15:34:59.000Z" itemprop="datePublished">2021-09-14</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="一、-背景"><a href="#一、-背景" class="headerlink" title="一、 背景"></a>一、 背景</h2><p>众所周知，web项目的部署形式，jar因其运行和部署的便捷性，时下非常流行。然而，在前端文件需要频繁更新的情况下，往往war包在替换时更加轻量快捷。这里就jar向war的转换进行说明，用以备忘。</p>
<h2 id="二、-实现"><a href="#二、-实现" class="headerlink" title="二、 实现"></a>二、 实现</h2><p>转换分为一下几个流程：</p>
<h3 id="1-提供SpringBootServletInitializer子类，并重写configure方法"><a href="#1-提供SpringBootServletInitializer子类，并重写configure方法" class="headerlink" title="1. 提供SpringBootServletInitializer子类，并重写configure方法"></a>1. 提供<code>SpringBootServletInitializer</code>子类，并重写<code>configure</code>方法</h3><p>这样可以利用Spring Framework对Servlet3.0规范支持，，并允许您在应用程序由 servlet 容器启动时对其进行配置。 通常，您应该更新应用程序的主类以扩展 <code>SpringBootServletInitializer</code>，如以下示例所示：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginWithConsistentRedisSessionApplication</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> application.sources(LoginWithConsistentRedisSessionApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(LoginWithConsistentRedisSessionApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-修改打包方式为war"><a href="#2-修改打包方式为war" class="headerlink" title="2. 修改打包方式为war"></a>2. 修改打包方式为war</h3><p>如果使用Mavan和<code>spring-boot-starter-parent</code>，修改pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果使用Gradle，则需要修改build.gradle来使用war插件  </p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;war&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-确保嵌入式servlet容器不会影响war包部署"><a href="#3-确保嵌入式servlet容器不会影响war包部署" class="headerlink" title="3. 确保嵌入式servlet容器不会影响war包部署"></a>3. 确保嵌入式servlet容器不会影响war包部署</h3><p> 为此，需要将嵌入的 servlet 容器依赖项标记为已提供。</p>
<p>如果使用maven，则修改如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果使用Gradle，则采用如下方法来标记</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    providedRuntime <span class="string">&#x27;org.springframework.boot:spring-boot-starter-tomcat&#x27;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/09/14/jar%E5%92%8Cwar%E7%9A%84%E8%BD%AC%E6%8D%A2/" data-id="cktk9ft0r0000q4i4fvlg80ay"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/" rel="tag">Spring Boot</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL通配符过滤" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E9%80%9A%E9%85%8D%E7%AC%A6%E8%BF%87%E6%BB%A4/">SQL通配符过滤</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E9%80%9A%E9%85%8D%E7%AC%A6%E8%BF%87%E6%BB%A4/" class="article-date">
  <time datetime="2021-07-21T15:26:18.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><strong>通配符</strong>(wildcard) 用来匹配值的一部分的特殊字符。  </p>
<p><strong>搜索模式</strong>(search pattern)由字面值、通配符或两者组合构成的搜索条件。  </p>
<p><strong>谓词</strong>(predicate)操作符在做谓词时不是操作符。技术上说，LIKE是谓词而不是操作符。  </p>
<p>%通配符表示任何字符出现任意次数，在Access中使用*而不是%。  </p>
<p>_通配符与%一样，但它只能匹配单个字符，不能多也不能少。DB2不支持通配符_，Access需要使用?而不是_。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- WILDCARD FILTER</span></span><br><span class="line"><span class="comment">-- LIKE OPERATOR</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- % WILDCARD</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">'Fish%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">'%bean bag%'</span>; <span class="comment">--Access使用*而不是%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> prod_name <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">'F%y'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- _ WILDCARD</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">'__ inch teddy bear'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, prod_name <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">'% inch teddy bear'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- [] 通配符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_contact <span class="keyword">LIKE</span> <span class="string">'[JM]%'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_contact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_contact <span class="keyword">LIKE</span> <span class="string">' (JM)%'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_contact;  <span class="comment">-- 否定，Access中使用!而不是^</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> <span class="keyword">NOT</span> cust_contact <span class="keyword">LIKE</span> <span class="string">'[JM]%'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_contact;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E9%80%9A%E9%85%8D%E7%AC%A6%E8%BF%87%E6%BB%A4/" data-id="ckrdp6n6x0022ksi4rcidlh3c"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL使用游标" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87/">SQL使用游标</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p><strong>结果集</strong> SQL查询所检索出的结果。<br>有时需要在检索出来的行中前进或者后退一行或多行，这就是游标的用途所在。<br><strong>游标</strong>是一个存储在DBMS服务器上的数据库查询，它不是一条SELECT语句，而是被该语句检索出来的结果集。<br>游标常见的一些选项和特性如下：</p>
<ul>
<li>能够标记游标为只读，使数据能读取，但不能更新和删除</li>
<li>能控制可以执行的定向操作（向前、向后、第一、绝对位置、相对位置等）</li>
<li>能标记某些列为可编辑的，某些列为不可编辑的</li>
<li>规定范围，使游标对创建它的特定请求（如存储过程）或对所有请求可访问</li>
<li>只是DBMS对检索出的数据（而不是指出表中活动数据）进行复制，使数据在游标打开和访问期间不变化</li>
</ul>
<h2 id="使用游标"><a href="#使用游标" class="headerlink" title="使用游标"></a>使用游标</h2><p>使用游标涉及几个明确的步骤：</p>
<ul>
<li>在使用游标前，必须声明（定义）它</li>
<li>一旦声明，就必须打开游标以供使用</li>
<li>对于填有数据的游标，根据需要取出（检索）各行</li>
<li>在结束游标使用时，必须关闭游标，可以的话，释放游标</li>
</ul>
<h3 id="创建游标"><a href="#创建游标" class="headerlink" title="创建游标"></a>创建游标</h3><p>使用DELAERE语句创建游标</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE CURSOR</span></span><br><span class="line"><span class="keyword">DECLARE</span> CustCursor <span class="keyword">CURSOR</span> </span><br><span class="line"><span class="keyword">FOR</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="comment">-- DB2 MariaDB MySQL SQL Server</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">CURSOR</span> CustCursor</span><br><span class="line"><span class="keyword">IS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span> <span class="comment">-- Oracle PostgreSQL</span></span><br></pre></td></tr></table></figure>

<h3 id="使用游标-1"><a href="#使用游标-1" class="headerlink" title="使用游标"></a>使用游标</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UTILIZE CURSOR</span></span><br><span class="line">OPEN CURSOR CustCursor</span><br></pre></td></tr></table></figure>

<p>FETCH可以访问游标数据。FETCH指出要检索哪些行，从何处检索它们以及将它们放于何处（如变量名）。<br>使用Oracle语法从游标检索一行（第一行）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">TYPE</span> CustCursor <span class="keyword">IS</span> <span class="keyword">REF</span></span><br><span class="line"><span class="keyword">CURSOR</span></span><br><span class="line">	<span class="keyword">RETURN</span> Customers%ROWTYPE;</span><br><span class="line"><span class="keyword">DECLARE</span> CustRecord</span><br><span class="line">Customres%ROWTYPE</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">OPEN</span> CustCursor;</span><br><span class="line">	FETCH CustCursor INTO CustRecord;</span><br><span class="line">	CLOSE CustCursor;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>使用Oracle语法，从第一行到最后一行，对检索出来的数据进行循环：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">TYPE</span> CustCursor <span class="keyword">IS</span> <span class="keyword">REF</span></span><br><span class="line"><span class="keyword">CURSOR</span></span><br><span class="line">    <span class="keyword">RETURN</span> Customers%ROWTYPE;</span><br><span class="line"><span class="keyword">DECLARE</span> CustRecord</span><br><span class="line">Customers%ROWTYPE</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">OPEN</span> CustCursor;</span><br><span class="line">    LOOP</span><br><span class="line">    FETCH CustCursor INTO CustRecord;</span><br><span class="line">    EXIT WHEN CustCursor%NOTFOUND;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">    CLOSE CustCursor;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>使用SQL Server</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> @cust_id <span class="built_in">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">	@cust_name <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_address <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_city <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_state <span class="built_in">CHAR</span>(<span class="number">5</span>),</span><br><span class="line">	@cust_zip <span class="built_in">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">	@cust_country <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_contact <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	@cust_email <span class="built_in">CHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">OPEN</span> CustCursor</span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> CustCursor</span><br><span class="line"><span class="keyword">INTO</span> @cust_id, @cust_name, @cust_address, @cust_city, @cust_state,</span><br><span class="line">@cust_zip, @cust_couontry, @cust_contact, @cust_email</span><br><span class="line"><span class="keyword">WHILE</span> @@FETCH_STATUS = <span class="number">0</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> CustCursor</span><br><span class="line">	<span class="keyword">INTO</span> @cust_id, @cust_name, @cust_address, @cust_city, @cust_state, </span><br><span class="line">	@cust_zip, @cust_coruntry, @cust_contact, @cust_email</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">CLOSE</span> CustCursor</span><br></pre></td></tr></table></figure>

<h3 id="关闭游标"><a href="#关闭游标" class="headerlink" title="关闭游标"></a>关闭游标</h3><p>DB2、 Oracle和PostgreSQL的语法关闭游标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE CustCursor</span><br></pre></td></tr></table></figure>

<p>SQL Server</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLOSE CustCursor</span><br><span class="line"><span class="keyword">DEALLOCATE</span> <span class="keyword">CURSOR</span> CustCursor</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87/" data-id="ckrdp6n4m0004ksi4xod7k8u9"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL使用数据处理函数" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/">SQL使用数据处理函数</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p><img src="/images/20190524144953320_24174.png" alt="DBMS函数的差异"></p>
<h2 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h2><h3 id="文本处理函数"><a href="#文本处理函数" class="headerlink" title="文本处理函数"></a>文本处理函数</h3><p><img src="/images/20190524145958787_19315.png" alt="常用的文本处理函数"><br>SOUNDEX是一个将任何文本串转换为描述其语音表示的字幕数字模式的算法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> vend_name, <span class="keyword">UPPER</span>(vend_name) <span class="keyword">AS</span> vend_name_upcase <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_contact = <span class="string">'Michael Green'</span>;  <span class="comment">-- 联系名错误，实际上应该是Michael Green</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> <span class="keyword">SOUNDEX</span>(cust_contact) = <span class="string">'Michael Green'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="日期和时间处理函数"><a href="#日期和时间处理函数" class="headerlink" title="日期和时间处理函数"></a>日期和时间处理函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- DATE AND TIME FUNCTION</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> <span class="keyword">DATEPART</span>(yy, order_date) = <span class="number">2012</span>;  <span class="comment">-- SQL Server 适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> <span class="keyword">DATEPART</span>(<span class="string">'yyyy'</span>, order_date) = <span class="number">2012</span>; <span class="comment">-- Access适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> DATE_PART(<span class="string">'year'</span>, order_date) = <span class="number">2012</span>; <span class="comment">-- PostgreSQL适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> to_number(to_char(order_date, <span class="string">'YYYY'</span>)) = <span class="number">2012</span>; <span class="comment">-- Oracle适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> order_date <span class="keyword">BETWEEN</span> <span class="keyword">to_date</span>(<span class="string">'01-01-2012'</span>) <span class="keyword">AND</span> <span class="keyword">to_date</span>(<span class="string">'12-31-2012'</span>); <span class="comment">-- Oracle</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(order_date) = <span class="number">2012</span>; <span class="comment">-- MySQL 和MariaDB适用</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> strfime(<span class="string">'%Y'</span>, order_date) = <span class="number">2012</span>; <span class="comment">-- SQLite</span></span><br></pre></td></tr></table></figure>

<h3 id="数值处理函数"><a href="#数值处理函数" class="headerlink" title="数值处理函数"></a>数值处理函数</h3><p>在主要DBMS的函数中，数值函数是最一致、最统一的函数。<br><img src="/images/20190524152132600_3337.png" alt="常用数值处理函数"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0/" data-id="ckrdp6n4n0005ksi4zvythd9k"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL存储过程" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">SQL存储过程</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>存储过程就是为以后使用而保存的一条或多条SQL语句。</p>
<h2 id="为什么使用存储过程"><a href="#为什么使用存储过程" class="headerlink" title="为什么使用存储过程"></a>为什么使用存储过程</h2><p>使用存储过程的主要理由：</p>
<ul>
<li>通过把处理封装在一个易用的单元中，可以简化复杂的操作。</li>
<li>不要求反复建立一系列处理步骤，因而保证了数据的一致性。</li>
<li>简化对变动的管理。</li>
<li>存储过程通常以编译过的形式存储，所以提高了性能。</li>
<li>一些只能用在单个请求的SQL元素和特性，存储过程可以使用它们来编写功能更强更灵活的代码。<br>存储过程的一些缺陷：</li>
<li>不同DBMS的存储过程语法有所不同。</li>
<li>编写存储过程 比编写SQL语句复杂。<h2 id="执行存储过程"><a href="#执行存储过程" class="headerlink" title="执行存储过程"></a>执行存储过程</h2>执行存储过程的SQL语句很简单，即EXECUTE。<br>EXECUTE接受存储过程名和需要传递给它的任何参数。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- EXECUTE PROCEDURE</span></span><br><span class="line"><span class="keyword">EXECUTE</span> AddNewProduct(<span class="string">'JSTS01'</span>,</span><br><span class="line"><span class="string">'Stuffed Eiffel Tower'</span>,</span><br><span class="line"><span class="number">6.49</span>,</span><br><span class="line"><span class="string">'Plush stuffed toy with the text La Tour Eiffel in red white and blue'</span>);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE PROCEDURE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MailingListCount(</span><br><span class="line">	ListCount <span class="keyword">OUT</span> <span class="built_in">INTEGER</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">IS</span> </span><br><span class="line">v_rows <span class="built_in">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> v_rows</span><br><span class="line">	<span class="keyword">FROM</span> Customers</span><br><span class="line">	<span class="keyword">WHERE</span> <span class="keyword">NOT</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line">	ListCount := v_rows;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>这个存储过程有一个名为ListCount的参数。此参数从存储过程返回一个值而不是传递一个值给存储过程。关键字OUT来指示这种行为。<br>Oracle支持IN（传递值给存储过程）、OUT（从存储过程返回值）、INOUT（即传递值给存储过程也从存储过程返回值）类型的参数<br>存储过程的代码括在BEGIN和END语句中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE PROCEDURE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MailingListCount(</span><br><span class="line">	ListCount <span class="keyword">OUT</span> <span class="built_in">INTEGER</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">IS</span> </span><br><span class="line">v_rows <span class="built_in">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> v_rows</span><br><span class="line">	<span class="keyword">FROM</span> Customers</span><br><span class="line">	<span class="keyword">WHERE</span> <span class="keyword">NOT</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line">	ListCount := v_rows;</span><br><span class="line"><span class="keyword">END</span>;  <span class="comment">-- ORACLE PROCEDURE</span></span><br><span class="line"></span><br><span class="line">var ReturnValue NUMBER</span><br><span class="line">EXEC MailingListCount(:ReturnValue);</span><br><span class="line"><span class="keyword">SELECT</span> ReturnValue; <span class="comment">-- EXEC ORACLE PROCEDURE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MailingListCount </span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">DECLARE</span> @cnt <span class="built_in">INTEGER</span> </span><br><span class="line"><span class="keyword">SELECT</span> @cnt = <span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> cust_email <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line">RETURN @cnt; <span class="comment">-- CREATE SQL SERVER PROCEDURE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @ReturnValue <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">EXECUTE</span></span><br><span class="line">@ReturnVlaue = MailingListCount;</span><br><span class="line"><span class="keyword">SELECT</span> @ReturnValue; <span class="comment">-- EXEC SQL SERVER PROCEDURE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> NewOrder</span><br><span class="line">@cust_id <span class="built_in">CHAR</span>(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="comment">-- Declare variable for order number</span></span><br><span class="line"><span class="keyword">DECLARE</span> @order_num <span class="built_in">INTEGER</span></span><br><span class="line"><span class="comment">-- Get current highest order number</span></span><br><span class="line"><span class="keyword">SELECT</span> @order_num=<span class="keyword">MAX</span>(order_num) <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="comment">-- Determine next order number</span></span><br><span class="line"><span class="keyword">SELECT</span> @order_num=@order_num+<span class="number">1</span></span><br><span class="line"><span class="comment">-- Insert new order</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">Order</span>(order_num, order_date, cust_id)</span><br><span class="line"><span class="keyword">VALUES</span>(@order_num, <span class="keyword">GETDATE</span>(), @cust_id)</span><br><span class="line"><span class="comment">-- Return order number</span></span><br><span class="line"><span class="keyword">RETURN</span> @order_num;    <span class="comment">-- SQL Server</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> NewOrder</span><br><span class="line">@cust_id <span class="built_in">CHAR</span>(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="comment">-- Insert new order</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Orders(cust_id)</span><br><span class="line"><span class="keyword">VALUES</span>(@cust_id)</span><br><span class="line"><span class="comment">-- Return order num</span></span><br><span class="line"><span class="keyword">SELECt</span> order_num = @@<span class="keyword">IDENTITY</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" data-id="ckrdp6n4o0006ksi4k23i6ty3"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL创建和操纵表" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E7%BA%B5%E8%A1%A8/">SQL创建和操纵表</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E7%BA%B5%E8%A1%A8/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>两种创建表的方法：</p>
<ul>
<li>交互式创建和管理数据库表的工具</li>
<li>表也可以直接用SQL语句操纵</li>
</ul>
<h3 id="表创建基础"><a href="#表创建基础" class="headerlink" title="表创建基础"></a>表创建基础</h3><p>利用CREATE TABLE创建表，必须给出一下信息：</p>
<ul>
<li>新表的名字，在关键字CREAET TABLE之后给出</li>
<li>表列的名字和定义，用逗号分隔</li>
<li>有的DBMS还要求指定表的位置<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UPDATE</span></span><br><span class="line"><span class="keyword">UPDATE</span> Customers <span class="keyword">SET</span> cust_email = <span class="string">'kim@thetoystore.com'</span> <span class="keyword">WHERE</span> cust_id = <span class="string">'1000000005'</span>; <span class="comment">-- UPDATE SINGLE COLUMN</span></span><br><span class="line"><span class="keyword">UPDATE</span> Customers <span class="keyword">SET</span> cust_contact = <span class="string">'Sam Roberts'</span>, cust_email = <span class="string">'sam@toyland.com'</span> <span class="keyword">WHERE</span> cust_id = <span class="string">'1000000006'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> Customers <span class="keyword">SET</span> cust_email=<span class="literal">NULL</span> <span class="keyword">WHERE</span> cust_id=<span class="string">'1000000005'</span>;</span><br><span class="line"><span class="comment">-- DELETE</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_id=<span class="string">'1000000006'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CREATE AND MANIPULATE TABLE</span></span><br><span class="line"><span class="comment">-- CREATE TABLE </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Products </span><br><span class="line">(</span><br><span class="line">	prod_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	vend_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	prod_name <span class="built_in">CHAR</span>(<span class="number">254</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	prod_price <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	prod_desc <span class="built_in">VARCHAR</span>(<span class="number">1000</span>) <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="使用NULL值"><a href="#使用NULL值" class="headerlink" title="使用NULL值"></a>使用NULL值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- NULL </span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">	order_num <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	order_date DATETIME <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	cust_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Vendors </span><br><span class="line">(</span><br><span class="line">	vend_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	vend_name <span class="built_in">CHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	vend_address <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	vend_city <span class="built_in">CHAR</span>(<span class="number">50</span>),</span><br><span class="line">	vend_state <span class="built_in">CHAR</span>(<span class="number">5</span>),</span><br><span class="line">	vend_zip <span class="built_in">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">	vend_country <span class="built_in">CHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="指定默认值"><a href="#指定默认值" class="headerlink" title="指定默认值"></a>指定默认值</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> OrderItems</span><br><span class="line">(</span><br><span class="line">	order_num <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	order_item <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	prod_id <span class="built_in">CHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	quantity <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">	item_price <span class="built_in">DEcimal</span>(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="/images/20190526200940817_28366.png" alt="获得系统日期"></p>
<h2 id="更新表"><a href="#更新表" class="headerlink" title="更新表"></a>更新表</h2><p>使用ALTER TABLE 时需要考虑的事情：</p>
<ul>
<li>理想情况下，不要再表中包含数据时对其进行更新。</li>
<li>所有的DBMS都允许给现有的表增加列，不过对所增加列的数据类型（以及NULL和DEFAULT的使用）有所限制。</li>
<li>许多DBMS不允许删除或更改表中的列。</li>
<li>多数DBMS允许重新命名表中的列。</li>
<li>许多DBMS限制对已经填有数据的列进行更改，对未填有数据的列几乎没有限制。<br>使用ALTER TABLE更改表结构，必须给出下面的信息：</li>
<li>在ALTER TABLE 之后给出要更改的表名（该表必须存在，否则将出错）</li>
<li>列出要做哪些更改</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ALTER TABLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Vendors <span class="keyword">ADD</span> vend_phone <span class="built_in">CHAR</span>(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Vendors <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> vend_phone;</span><br></pre></td></tr></table></figure>

<p>复杂的表结构更改一般需要手动删除过程，它涉及以下步骤：</p>
<ol>
<li>用心的列布局创建一个新表</li>
<li>使用INSERT SELECT语句从旧表复制数据到新表。</li>
<li>检验包含所需数据的新表</li>
<li>重命名旧表（如果确定，可以删除它）</li>
<li>用旧表原来的名字重命名新表</li>
<li>根据需要，重新创建触发器、存储过程、索引和外键</li>
</ol>
<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> CustCopy;</span><br></pre></td></tr></table></figure>

<h2 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h2><p>DB2、MariaDB、MySQL、Oracle和PostgreSQL用户使用RENAME语句，SQL Server用户使用sp_rename存储过程，SQLite用户使用ALTER TABLE 语句。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E7%BA%B5%E8%A1%A8/" data-id="ckrdp6n4r0009ksi4zor2ffad"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL创建计算字段" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5/">SQL创建计算字段</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h2><p><strong>字段</strong>(field)基本上与<strong>列</strong>(column)的意思相同，经常互换使用，不过数据库列一般称为列，而属于<strong>字段</strong>通常与计算字段一起使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CALCULATE FIELD</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_name + <span class="string">'('</span> + vend_country + <span class="string">')'</span> <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> vend_name || <span class="string">'('</span> || vend_country || <span class="string">')'</span> <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'('</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">')'</span> <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'('</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">')'</span> <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br></pre></td></tr></table></figure>

<h2 id="拼接字段"><a href="#拼接字段" class="headerlink" title="拼接字段"></a>拼接字段</h2><p><strong>拼接</strong>(concatenate)将值联结到一起(将一个值附加到另一个值)构成单个值。<br>Access和SQL Server使用+号。DB2、Oracle、PostgreSQL、SQLite和Open Office Base使用||。在MySQL和MariaDB中，必须使用特殊的函数。<br>许多数据库保存填充为列宽的文本值，而实际上你要的结果不需要这些空格。<br>大多数DBMS都支持RTRIM()去掉字符串右边的空格、LTRIM()去掉字符串左边的空格、TRIM()去掉字符串左右两边的空格。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">-- ALIAS </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'('</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">')'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'('</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">')'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br></pre></td></tr></table></figure>

<h2 id="执行算术计算"><a href="#执行算术计算" class="headerlink" title="执行算术计算"></a>执行算术计算</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- EXECUTE CALCULATE</span></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, quantity, item_price <span class="keyword">FROM</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">20008</span>;</span><br><span class="line"><span class="keyword">SELECT</span> prod_id, quantity, item_price, quantity*item_price <span class="keyword">AS</span> expanded_price <span class="keyword">FROM</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">20008</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">3</span>*<span class="number">2</span>；</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">Trim</span>(<span class="string">'abc'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">Now</span>();</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5/" data-id="ckrdp6n4t000aksi4y0ydibsr"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL分组数据" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E5%88%86%E7%BB%84%E6%95%B0%E6%8D%AE/">SQL分组数据</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E5%88%86%E7%BB%84%E6%95%B0%E6%8D%AE/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p>分组数据以汇总表内容的子集，涉及两个新SELECT语句子句：GROUP BY子句和HAVING子句。</p>
<h2 id="数据分组"><a href="#数据分组" class="headerlink" title="数据分组"></a>数据分组</h2><h2 id="创建分组"><a href="#创建分组" class="headerlink" title="创建分组"></a>创建分组</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE GROUP</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_prods <span class="keyword">FROM</span> Products <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id;</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_price, <span class="keyword">count</span>(*) <span class="keyword">as</span> num_prods <span class="keyword">FROM</span> Products <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id, prod_price;</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_price, <span class="keyword">count</span>(*) <span class="keyword">as</span> num_prods <span class="keyword">FROM</span> Products <span class="keyword">GROUP</span> <span class="keyword">BY</span> prod_price,vend_id;</span><br></pre></td></tr></table></figure>

<h2 id="过滤分组"><a href="#过滤分组" class="headerlink" title="过滤分组"></a>过滤分组</h2><p>HAVING非常类似于WHERE。所有类型的WHERE子句都可以用HAVING来替代。唯一的区别是WHERE过滤行，而HAVING过滤分组。<br>HAVING支持所有WHERE操作符。<br>HAVING和WHERE的差别：WHERE在数据分组前进行过滤，HAVING在数据分组后进行过滤。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FILTER GROUP</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_id, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> orders <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">2</span>;</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_prods <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_price &gt;= <span class="number">4</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">2</span>;</span><br><span class="line"><span class="keyword">SELECT</span> vend_id, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_prods <span class="keyword">FROM</span> Products <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h2 id="分组和排序"><a href="#分组和排序" class="headerlink" title="分组和排序"></a>分组和排序</h2><p><img src="/images/20190524192513009_26824.png" alt="ORDER BY与GROUP BY"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- GROUP AND SORT</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> items <span class="keyword">FROM</span> OrderItems <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">3</span>;</span><br><span class="line"><span class="keyword">SELECT</span> order_num, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> items <span class="keyword">FROM</span> OrderItems <span class="keyword">GROUP</span> <span class="keyword">BY</span> order_num <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">3</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> items, order_num;</span><br></pre></td></tr></table></figure>

<h2 id="SELECT子句顺序"><a href="#SELECT子句顺序" class="headerlink" title="SELECT子句顺序"></a>SELECT子句顺序</h2><p><img src="/images/20190524193720235_30687.png" alt="SELECT子句及其顺序"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E5%88%86%E7%BB%84%E6%95%B0%E6%8D%AE/" data-id="ckrdp6n4x000fksi4wsog3p20"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL创建高级联结" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E9%AB%98%E7%BA%A7%E8%81%94%E7%BB%93/">SQL创建高级联结</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E9%AB%98%E7%BA%A7%E8%81%94%E7%BB%93/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="使用表别名"><a href="#使用表别名" class="headerlink" title="使用表别名"></a>使用表别名</h2><p>SQL除了可以对列名和计算字段使用别名，还允许给表名起别名。这样做有两个理由：</p>
<ul>
<li>缩短SQL语句；</li>
<li>允许在一条SELECT语句中多次使用相同的表。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- UTILIZED TABLE ALIAS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'（'</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">AS</span> C, Orders <span class="keyword">AS</span> O, OrderItems <span class="keyword">AS</span> OI <span class="keyword">WHERE</span> C.cust_id = O.cust_id <span class="keyword">AND</span> OI.order_num = O.order_num <span class="keyword">AND</span> prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="使用不同类型的联结"><a href="#使用不同类型的联结" class="headerlink" title="使用不同类型的联结"></a>使用不同类型的联结</h2><p>迄今为止，上述使用的只是内联结或<strong>等值联结</strong>的简单链接。现在来看三种其他联结：</p>
<ul>
<li>自联结（self-join）</li>
<li>自然联结（natural join）</li>
<li>外联结（outer join）<h3 id="自联结"><a href="#自联结" class="headerlink" title="自联结"></a>自联结</h3>联结中使用的两个表是相同的表，此时需要使用表别名。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SELF-JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_id, cust_name, cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name = (<span class="keyword">SELECT</span> cust_name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_contact = <span class="string">'Jim Jones'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> c1.cust_id, c1.cust_name, c1.cust_contact <span class="keyword">FROM</span> Customers <span class="keyword">AS</span> c1, Customers <span class="keyword">AS</span> c2 <span class="keyword">WHERE</span> c1.cust_name = c2.cust_name <span class="keyword">AND</span> c2.cust_contact = <span class="string">'Jim Jones'</span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="自然联结"><a href="#自然联结" class="headerlink" title="自然联结"></a>自然联结</h3><p>无论何时进行联结，应该至少有一列不止出现在一个表中（被联结的列）。<strong>自然联结</strong>排除重复出现的列，使每列只返回一次。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- NATURAL-JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> C.*, O.order_num, O.order_date, OI.prod_id, OI.quantity, OI.item_price <span class="keyword">FROM</span> Customers <span class="keyword">AS</span> C, Orders <span class="keyword">AS</span> O, OrderItems <span class="keyword">AS</span> OI <span class="keyword">WHERE</span> C.cust_id = O.cust_id <span class="keyword">AND</span> OI.order_num = O.order_num <span class="keyword">AND</span> prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="外联结"><a href="#外联结" class="headerlink" title="外联结"></a>外联结</h3><p>联结包含在相关表中没有关联行的行，这种联结称为<strong>外联结</strong>。<br>与内联结关联两个表中的行不同的是，外联结还包括没有关联行的行。<br>在使用OUTER JOIN语法时，必须使用RIGHT或LEFT关键字指定包括其所有行的表（RIGHT指出的是OUTER JOIN右边的表，而LEFT指出的是OUTER JOIN左边的表）。<br>还存在另一种外联结，就是全外连接（full outer join）,它检索两个表中的所有行并关联那些可以关联的行。全外联结包含两个表的不关联的行。<br>Access、MariaDB、MySQL、Open Office Base 或SQLite不支持FULL OUTER JOIN语法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- OUTER-JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, Orders.order_num <span class="keyword">FROM</span> Customers <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id = Orders.cust_id; <span class="comment">-- INNER-JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, Orders.order_num <span class="keyword">FROM</span> Customers <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id = Orders.cust_id; <span class="comment">-- LEFT OUTER-JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, Orders.order_num <span class="keyword">FROM</span> Customers <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id = Orders.cust_id; <span class="comment">-- RIGHT OUTER-JOIN</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, Orders.order_num <span class="keyword">FROM</span> Orders <span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id = Customers.cust_id;</span><br></pre></td></tr></table></figure>

<h2 id="使用带聚集函数的联结"><a href="#使用带聚集函数的联结" class="headerlink" title="使用带聚集函数的联结"></a>使用带聚集函数的联结</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- JOIN WITH AGGREGATE FUNCTION</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, Orders.order_num <span class="keyword">FROM</span> Customers <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id = Orders.cust_id; <span class="comment">-- WITHOUT AGGREGATE</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, <span class="keyword">COUNT</span>(Orders.order_num) <span class="keyword">AS</span> num_ord <span class="keyword">FROM</span> Customers <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id = Orders.cust_id <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customers.cust_id;  <span class="comment">-- WITH AGGREAGTE</span></span><br><span class="line"><span class="keyword">SELECT</span> Customers.cust_id, <span class="keyword">COUNT</span>(Orders.order_num) <span class="keyword">AS</span> num_ord <span class="keyword">FROM</span> Customers <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id = Orders.cust_id <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>

<h2 id="使用联结和联结条件"><a href="#使用联结和联结条件" class="headerlink" title="使用联结和联结条件"></a>使用联结和联结条件</h2><p>联结及其使用的要点：</p>
<ul>
<li>注意所使用的联结类型。一般我们使用内联结，但是用外联结也有效。</li>
<li>确切的联结语法，查看具体的文档</li>
<li>保证使用正确的联结条件</li>
<li>应该总是提供联结条件</li>
<li>在一个联结中可以包含多个表，甚至可以对每个联结采用不同的联结类型。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E5%88%9B%E5%BB%BA%E9%AB%98%E7%BA%A7%E8%81%94%E7%BB%93/" data-id="ckrdp6n4y000iksi4zwuuj113"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
        <article id="post-SQL使用视图" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 itemprop="name">
      <a class="article-title" href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE/">SQL使用视图</a>
    </h2>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE/" class="article-date">
  <time datetime="2021-07-21T14:16:16.000Z" itemprop="datePublished">2021-07-21</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/SQL/">SQL</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是虚拟的表。视图只包含使用时动态检索数据的查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- VIEW</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> Customers, Orders, OrderItems <span class="keyword">WHERE</span> Customers.cust_id = Orders.cust_id <span class="keyword">AND</span> OrderItems.order_num = Orders.order_num <span class="keyword">AND</span> prod_id = <span class="string">'RGAN01'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> ProductCustomers <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="为什么使用视图"><a href="#为什么使用视图" class="headerlink" title="为什么使用视图"></a>为什么使用视图</h3><p>视图的一些常见应用：</p>
<ul>
<li>重用SQL语句</li>
<li>简化复杂的SQL操作。</li>
<li>使用表的一部分而不是整个表</li>
<li>保护数据。可以授权用户访问表的特定部分的权限，而不是整个表的访问权限。</li>
<li>更改数据格式和表示</li>
</ul>
<h3 id="视图的规则与限制"><a href="#视图的规则与限制" class="headerlink" title="视图的规则与限制"></a>视图的规则与限制</h3><p>视图创建和使用的一些最常见的规则和限制：</p>
<ul>
<li>与表一样，视图必须唯一命名</li>
<li>对于可以创建的视图数目没有限制</li>
<li>创建视图，必须具有足够的访问权限</li>
<li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造视图</li>
<li>许多DBMS禁止在视图查询中使用ORDER BY子句</li>
<li>有些DBMS要求对返回的列进行命名，如果列是计算字段，则需要使用别名</li>
<li>视图不能索引，也不能有关联的触发器或默认值</li>
<li>有些DBMS把视图作为只读的查询，这表示可以从试图检索数据，但不能将数据写回底层表</li>
<li>有些DBMS允许创建这样的视图，它不能进行导致行不再属于视图的插入或更新。</li>
</ul>
<h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h2><p>视图用CREATE VIEW语句来创建。<br>删除视图，可以使用DROP语句，其语法为DROP VIEW viewname.</p>
<h3 id="利用视图简化复杂的联结"><a href="#利用视图简化复杂的联结" class="headerlink" title="利用视图简化复杂的联结"></a>利用视图简化复杂的联结</h3><p>一个最常见的视图应该是隐藏复杂的SQL，这通常涉及联结。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE VIEW</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ProductCustomers <span class="keyword">AS</span> <span class="keyword">SELECT</span> cust_name, cust_contact, prod_id <span class="keyword">FROM</span> Customers, Orders, OrderItems <span class="keyword">WHERE</span> Customers.cust_id = Orders.cust_id <span class="keyword">AND</span> OrderItems.order_num = Orders.order_num; <span class="comment">-- CREATE VIEW</span></span><br><span class="line"><span class="keyword">SELECT</span> cust_name, cust_contact <span class="keyword">FROM</span> ProductCustomers <span class="keyword">WHERE</span> prod_id = <span class="string">'RGAN01'</span>; <span class="comment">-- SELECT FROM VIEW</span></span><br></pre></td></tr></table></figure>

<h3 id="用视图重新格式化检索出的"><a href="#用视图重新格式化检索出的" class="headerlink" title="用视图重新格式化检索出的"></a>用视图重新格式化检索出的</h3><p>视图的另一常见用途是重新格式化检索出的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FORMAT DATA</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'（'</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'（'</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> VendorsLocations <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) + <span class="string">'（'</span> + <span class="keyword">RTRIM</span>(vend_country) + <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> VendorsLocations <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="keyword">RTRIM</span>(vend_name) || <span class="string">'（'</span> || <span class="keyword">RTRIM</span>(vend_country) || <span class="string">'）'</span> <span class="keyword">AS</span> vend_title <span class="keyword">FROM</span> Vendors;</span><br></pre></td></tr></table></figure>

<h3 id="用视图过滤不想要的数据"><a href="#用视图过滤不想要的数据" class="headerlink" title="用视图过滤不想要的数据"></a>用视图过滤不想要的数据</h3><p>视图对于应用哦个普通的WHERE子句也很有用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FILTER NOT NEED DATA USE VIEW</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> CustomerEMailList <span class="keyword">AS</span> <span class="keyword">SELECT</span> cust_id, cust_name, cust_email <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> CustomerEMailList;</span><br></pre></td></tr></table></figure>

<h3 id="使用视图与计算字段"><a href="#使用视图与计算字段" class="headerlink" title="使用视图与计算字段"></a>使用视图与计算字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- USE VIEW AND CALCULATE FIELD</span></span><br><span class="line"><span class="keyword">SELECT</span> prod_id, quantity, item_price, quantity*item_price <span class="keyword">AS</span> expanded_price <span class="keyword">FROM</span> OrderItems <span class="keyword">WHERE</span> order_num = <span class="number">20008</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> OrderItemsExpanded <span class="keyword">AS</span> <span class="keyword">SELECT</span> order_num, prod_id, quantity, item_price, quantity*item_price <span class="keyword">AS</span> expanded_price <span class="keyword">FROM</span> OrderItems;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OrderItemsExpanded <span class="keyword">WHERE</span> order_num=<span class="number">20008</span>;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://xperblueray.com/2021/07/21/SQL%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE/" data-id="ckrdp6n4h0001ksi496lmeb1u"
         class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%9F%BA%E7%A1%80/" rel="tag">SQL基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" rel="tag">SQL必知必会</a></li></ul>

    </footer>

  </div>

  

  

</article>



      
  </article>
  

  
    <nav class="page-nav">
      
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next page</a>
    </nav>
  
</section>
</div>

  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2021 星空</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="星空"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/snap.svg-min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>






<script src="/js/ocean.js"></script>


</body>
</html>